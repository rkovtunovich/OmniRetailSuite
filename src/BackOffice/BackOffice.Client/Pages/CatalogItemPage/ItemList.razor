@page "/catalog-items"
@* @attribute [Authorize(Roles = BlazorShared.Authorization.Constants.Roles.ADMINISTRATORS)] *@
@attribute [Authorize]
@inherits BlazorComponent

@namespace BackOffice.Client.Pages.CatalogItemPage

<PageTitle>Manage Catalog Item</PageTitle>

<RadzenSplitter Style="display:flex; min-width:100%; height:100%; padding:0">
    
    <RadzenSplitterPane>

        <MudDataGrid T="Item" @ref="@(_dataGrid)" Items="@_catalogItems" Filterable="true" QuickFilter="@_quickFilter" EditMode="@(_editMode)" EditTrigger="@(_editTrigger)"
                     StartedEditingItem="@StartedEditingItem" CanceledEditingItem="@CanceledEditingItem" CommittedItemChanges="@CommittedItemChanges" ReadOnly="false" RowClick="RowClick"
                     EditDialogOptions="_dialogOptions" FixedHeader="true" HeaderClass="data-grid-header" Dense="true" ColumnResizeMode="ResizeMode.Column"
                     DragDropColumnReordering="true" Style="height:100%; display:flex; flex-direction:column; width:100%; resize:horizontal">


            <ToolBarContent>

                <MudButton OnClick="@CreateItemClick" Color="@Color.Success" Class="add-item-btn">Add</MudButton>
                <MudSpacer />
                <MudTooltip Text="hierarchy">
                    <MudButton Color="@Color.Primary" @onclick="@OpenItemParentsClick">
                        <iconify-icon icon="mdi:family-tree" width="24" height="24"></iconify-icon>
                    </MudButton>
                </MudTooltip>
                <MudTextField @bind-Value="@_searchString" Placeholder="Search" Adornment="Adornment.Start" Immediate="true"
                              AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0" Style="max-width:30%"></MudTextField>
            </ToolBarContent>

            <Columns>
                <PropertyColumn Property="x => x.Id" IsEditable="false" />
                <PropertyColumn Property="x => x.Name" />
                <PropertyColumn Property="x => x.Description" />
                <PropertyColumn Property="x => x.ItemType" Title="Type" IsEditable="false" />
                <PropertyColumn Property="x => x.Brand" Title="Brand" IsEditable="false" />
                <PropertyColumn Property="x => x.Price" />
                <PropertyColumn Property="x => x.Barcode" />
                <TemplateColumn CellClass="justify-end" Sortable="false" Filterable="false">
                    <CellTemplate>
                        <MudIconButton Size="@Size.Small" Icon="@Icons.Material.Outlined.FilterNone" OnClick="@(() => OpenItemClick(context))" />
                    </CellTemplate>
                </TemplateColumn>
            </Columns>

        </MudDataGrid>

    </RadzenSplitterPane>

    <RadzenSplitterPane Visible="@_isItemParentsOpen">

        <MudTreeView Items="@_itemParentsViewData" Hover="true" Style="max-width:50%; resize:horizontal">
            <ItemTemplate Context="item">
                <MudTreeViewItem Items="@item.Children">
                    <BodyContent>
                        <div style="display: grid; grid-template-columns: 1fr auto; align-items: center">
                            <MudText Style="justify-self: start;">@item.Id</MudText>
                            <MudText Style="justify-self: start;">@item.Name</MudText>
                            <div style="justify-self: end;">
                                <MudIconButton Icon="@Icons.Material.Filled.Edit" Size="Size.Medium" Color="Color.Inherit" />
                                <MudIconButton Icon="@Icons.Material.Filled.Delete" Size="Size.Medium" Color="Color.Inherit" />
                            </div>
                        </div>
                    </BodyContent>
                </MudTreeViewItem>
            </ItemTemplate>
        </MudTreeView>

    </RadzenSplitterPane>

</RadzenSplitter>

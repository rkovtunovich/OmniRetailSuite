@page "/product-items"
@* @attribute [Authorize(Roles = BlazorShared.Authorization.Constants.Roles.ADMINISTRATORS)] *@
@attribute [Authorize]
@namespace BackOffice.Client.Components.Pages.ProductCatalog.ItemPages

@inherits ListBase<ProductItem>

<MudSplitter Style=" min-width:100%; height:100%;" @bind-Dimension="@_splitterPercentage">

    <StartContent>

        <MudDataGrid T="ProductItem"
                     Items="@Items"
                     Filterable="true"
                     QuickFilter="@QuickFilter"
                     EditMode="@(_editMode)"
                     EditTrigger="@(_editTrigger)"
                     StartedEditingItem="@StartedEditingItem"
                     CanceledEditingItem="@CanceledEditingItem"
                     CommittedItemChanges="@CommittedItemChanges"
                     ReadOnly="false"
                     RowClick="RowClick"
                     RowContextMenuClick="RowClickContextMenu"
                     RowClass="cursor-pointer"
                     RowClassFunc="@((item, line) => SelectedRowClassFunc(item, line))"
                     EditDialogOptions="_dialogOptions"
                     FixedHeader="true"
                     HeaderClass="data-grid-header"
                     Dense
                     Hover
                     ColumnResizeMode="ResizeMode.Column"
                     DragDropColumnReordering="true"
                     Style="height:100%; display:flex; flex-direction:column; width:100%; resize:horizontal">


            <ToolBarContent>

                <MudButton OnClick="@CreateItemClick" Color="@Color.Success" Class="add-item-btn">@_localizer["Add"]</MudButton>
                <MudSpacer />

                <MudTextField @bind-Value="@QuickFilterSearchString" 
                              Placeholder="@_localizer["Search"]"
                              Adornment="Adornment.Start" 
                              AdornmentIcon="@Icons.Material.Filled.Search"
                              Immediate
                              Clearable
                              IconSize="Size.Medium" 
                              Class="ors-list-search-field"/>

                <MudTooltip Text="@_localizer["Hierarchy"]">
                    <MudButton Color="@Color.Primary" @onclick="@ShowCatalogParentsClick">
                        <iconify-icon icon="mdi:family-tree" width="24" height="24"></iconify-icon>
                    </MudButton>
                </MudTooltip>

            </ToolBarContent>

            <Columns>
                <PropertyColumn Property="x => x.GetCode()" Title="@_localizer["Code"]" IsEditable="false" />
                <PropertyColumn Property="x => x.Name" Title="@_localizer["Name"]" />
                <PropertyColumn Property="x => x.Description" Title="@_localizer["Description"]" />
                <PropertyColumn Property="x => x.ProductType" Title="@_localizer["Type"]" IsEditable="false" />
                <PropertyColumn Property="x => x.ProductBrand" Title="@_localizer["Brand"]" IsEditable="false" />
                <PropertyColumn Property="x => x.Price" Title="@_localizer["Price"]" />
                <PropertyColumn Property="x => x.Barcode" Title="@_localizer["Barcode"]" />
                <TemplateColumn CellClass="justify-end" Sortable="false" Filterable="false">
                    <CellTemplate>
                        <MudIconButton Size="@Size.Small" Icon="@IconHelper.Open" OnClick="@(() => OpenItemClick(context))" />
                    </CellTemplate>
                </TemplateColumn>
            </Columns>

        </MudDataGrid>

        <ContextMenu @ref="ContextMenu" Items="ContextMenuItems" />

    </StartContent>

    <EndContent>

        <MudContainer Class="d-block p-0 m-0">

            <MudToolBar>

                <MudButton OnClick="@CreateCatalogParentClick" Color="@Color.Success" Class="add-item-btn">@_localizer["Add"]</MudButton>
                <MudSpacer />

            </MudToolBar>

            <MudTreeView T="ProductParent" Items="@_itemParents" Hover="true" Dense>
                <ItemTemplate Context="item">

                    <MudTreeViewItem Items="@item.Children"
                                     Icon="@Icons.Material.Outlined.Folder"
                                     Value="item"
                                     OnDoubleClick="@(e => OnParentItemDoubleClick(item))"
                                     Class="@($"{GetItemClass(item)} ors-no-select")">

                        <BodyContent>
                            <div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
                                <MudText Class="ors-tree-item-parent-code" Style="flex-basis: 20%; margin-right: 16px;">@item.GetCode()</MudText>
                                <MudText Class="ors-tree-item-parent-name" Style="flex-grow: 1;">@item.Name</MudText>
                                <MudIconButton Size="@Size.Small"
                                               Icon="@IconHelper.Open"
                                               OnClick="@(() => OpenItemParentClick(context))" />
                            </div>
                        </BodyContent>

                    </MudTreeViewItem>

                </ItemTemplate>
            </MudTreeView>

        </MudContainer>

    </EndContent>

</MudSplitter>
